

.. _data_wrangling:

==============
Data wrangling
==============

.. _allen_data:

Working with data from the `AllenSDK <https://alleninstitute.github.io/AllenSDK/>`_
-----------------------------------------------------------------------------------


The data we use in our connectivity models comes from the AAV tracing exeriments
performed at the Allen Institute for Brain Science. The experiments consist of
injecting an AAV viral tracer into a region of the mouse brain and subsequently
imaging the brain after the virus has propogated down the axons of the infected
neurons. This imaging reveals how a group of infected neurons are structurally
connected to other regions of the brain.

AllenSDK
--------

The allensdk is a python package privided by the Allen Institute to allow for
retrieval and manipulation of the data generated by the experiments they perform.
We utilize the ``core`` subpackage which supports the data service of the
previously mentioned viral tracing experiments. Spefifically, we encorporate
the ``allensdk.core.MouseConnectivityCache`` object to pull experimental data
as well as register the data in the Allen 3D Reference Space.

MouseConnectivityCache
~~~~~~~~~~~~~~~~~~~~~~

The ``MouseConnectivityCache`` can be thought of as containing 2 parts:

- ``Cache`` object: for pulling experimental data
- ``ReferenceSpace`` object: for registering the data into the 3D volume


Additionally, the ``ReferenceSpace`` object contains:

- ``StructureTree`` object: ontological mapping of anatomically defined structures
- ``Annotation`` array: 3D volume labeling the structure to which each voxel belongs

.. _core:

Core Package
============

.. currentmodule:: mcmodels.core

Mask class
----------
In our package, we define mehtods relating to registering data into the 3D
reference space in our ``Mask`` class. Spefifically, we can:

- query only specific structures of the brain
- map masked vectors of the brain back to their corresponding locations in the
  3D reference space.
- determine to which structure each element of a masked vector belongs


Data pulling classes
---------------------
The ``VoxelData`` and ``RegionalData`` classes are used to pull experimental
data, selecting only experiments that pass user-defined parameters and selecting
only the regions of the brain relevant to the desired analysis. The indended
purpose of these classes is to form the ``X, y`` arrays to be used in fitting
connectivity models of the form ``y = f(X)``.
